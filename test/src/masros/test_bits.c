/**
 * @file test_bits_macros.c
 * @author Aleksander Kovalchuk (roux@yandex.ru)
 * @brief 
 * @date 2022-05-20
 */

//_____ I N C L U D E S _______________________________________________________
#include "unity.h"

#include <stdint.h>
#include <stdbool.h>
#include <stdlib.h>
#include <string.h>

#include "macros/bits.h"
//_____ C O N F I G S  ________________________________________________________

//_____ D E F I N I T I O N S _________________________________________________

//_____ M A C R O S ___________________________________________________________

//_____ V A R I A B L E S _____________________________________________________

//_____ P R I V A T E  F U N C T I O N S_______________________________________

//_____ P U B L I C  F U N C T I O N S_________________________________________
void test_SetBits(void)
{
	uint8_t test8 = 0;
	uint16_t test16 = 0;
	uint32_t test32 = 0;

	for (size_t i = 0; i < 8; i++)
	{
		SET_BIT(test8, i);
		TEST_ASSERT_BIT_HIGH(i, test8);		
	}

	for (size_t i = 0; i < 16; i++)
	{
		SET_BIT(test16, i);
		TEST_ASSERT_BIT_HIGH(i, test16);		
	}

	for (size_t i = 0; i < 32; i++)
	{
		SET_BIT(test32, i);
		TEST_ASSERT_BIT_HIGH(i, test32);		
	}	
}

void test_ClearBits(void)
{
	uint8_t test8 = 0xFF;
	uint16_t test16 = 0xFFFF;
	uint32_t test32 = 0xFFFFFFFF;

	for (size_t i = 0; i < 8; i++)
	{
		CLEAR_BIT(test8, i);
		TEST_ASSERT_BIT_LOW(i, test8);		
	}

	for (size_t i = 0; i < 16; i++)
	{
		CLEAR_BIT(test16, i);
		TEST_ASSERT_BIT_LOW(i, test16);		
	}

	for (size_t i = 0; i < 32; i++)
	{
		CLEAR_BIT(test32, i);
		TEST_ASSERT_BIT_LOW(i, test32);		
	}	
}

void test_ToggleBits(void)
{
	uint8_t test8 = 0;
	uint16_t test16 = 0;
	uint32_t test32 = 0;

	for (size_t i = 0; i < 8; i++)
	{
		TOGGLE_BIT(test8, i);
		TEST_ASSERT_BIT_HIGH(i, test8);	
        TOGGLE_BIT(test8, i);
        TEST_ASSERT_BIT_LOW(i, test8);
	}

	for (size_t i = 0; i < 16; i++)
	{
		TOGGLE_BIT(test16, i);
		TEST_ASSERT_BIT_HIGH(i, test16);
        TOGGLE_BIT(test16, i);
        TEST_ASSERT_BIT_LOW(i, test16);		
	}

	for (size_t i = 0; i < 32; i++)
	{
		TOGGLE_BIT(test32, i);
		TEST_ASSERT_BIT_HIGH(i, test32);
        TOGGLE_BIT(test32, i);
        TEST_ASSERT_BIT_LOW(i, test32);
	}	
}

void test_TestBits(void)
{
	uint32_t test = 0;

	for (size_t i = 0; i < 32; i++)
	{
		SET_BIT(test, i);
		TEST_ASSERT_TRUE(TEST_BIT(test, i));	
        CLEAR_BIT(test, i);
        TEST_ASSERT_FALSE(TEST_BIT(test, i));
	}
}

void test_Bitfield(void)
{
	TEST_ASSERT_EQUAL_UINT(0x00FF0000, MAKE_BITFIELD(23,16));
	TEST_ASSERT_EQUAL_UINT(0xFFFF0000, MAKE_BITFIELD(31,16));
	TEST_ASSERT_EQUAL_UINT(0x0000000F, MAKE_BITFIELD(3,0));
}

void test_NumBits(void)
{
	TEST_ASSERT_EQUAL_UINT(8, NUM_BITS(uint8_t));
	TEST_ASSERT_EQUAL_UINT(16, NUM_BITS(uint16_t));
	TEST_ASSERT_EQUAL_UINT(32, NUM_BITS(uint32_t));
}


void test_LSO(void)
{
	TEST_ASSERT_EQUAL_UINT(0b0000000000000001, LSO(0b0010011001010001));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000010, LSO(0b0010011001010010));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000100, LSO(0b0010011001010100));
	TEST_ASSERT_EQUAL_UINT(0b0000000000001000, LSO(0b0010011001011000));
	TEST_ASSERT_EQUAL_UINT(0b0000000000010000, LSO(0b0010011001010000));
	TEST_ASSERT_EQUAL_UINT(0b0000000000100000, LSO(0b0010011001100000));
	TEST_ASSERT_EQUAL_UINT(0b0000000001000000, LSO(0b0010011001000000));
	TEST_ASSERT_EQUAL_UINT(0b0000000010000000, LSO(0b0010011010000000));

	TEST_ASSERT_EQUAL_UINT(0b0000000100000000, LSO(0b0010011100000000));
	TEST_ASSERT_EQUAL_UINT(0b0000001000000000, LSO(0b0010011000000000));
	TEST_ASSERT_EQUAL_UINT(0b0000010000000000, LSO(0b1010010000000000));
	TEST_ASSERT_EQUAL_UINT(0b0000100000000000, LSO(0b0010100000000000));
	TEST_ASSERT_EQUAL_UINT(0b0001000000000000, LSO(0b1011000000000000));
	TEST_ASSERT_EQUAL_UINT(0b0010000000000000, LSO(0b1010000000000000));
	TEST_ASSERT_EQUAL_UINT(0b0100000000000000, LSO(0b0100000000000000));
	TEST_ASSERT_EQUAL_UINT(0b1000000000000000, LSO(0b1000000000000000));

	TEST_ASSERT_EQUAL_UINT(0b0000000000000001, LSO(0b1111111111111111));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000000, LSO(0b0000000000000000));
}

void test_LCO(void)
{
	TEST_ASSERT_EQUAL_UINT(0b0000000000000001, LCO(0b0010011001010010));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000010, LCO(0b0010011001010001));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000100, LCO(0b0010011001010011));
	TEST_ASSERT_EQUAL_UINT(0b0000000000001000, LCO(0b0010011001010111));
	TEST_ASSERT_EQUAL_UINT(0b0000000000010000, LCO(0b0010011001001111));
	TEST_ASSERT_EQUAL_UINT(0b0000000000100000, LCO(0b0010011001011111));
	TEST_ASSERT_EQUAL_UINT(0b0000000001000000, LCO(0b0010011000111111));
	TEST_ASSERT_EQUAL_UINT(0b0000000010000000, LCO(0b0010011001111111));

	TEST_ASSERT_EQUAL_UINT(0b0000000100000000, LCO(0b0010011011111111));
	TEST_ASSERT_EQUAL_UINT(0b0000001000000000, LCO(0b0010010111111111));
	TEST_ASSERT_EQUAL_UINT(0b0000010000000000, LCO(0b1010001111111111));
	TEST_ASSERT_EQUAL_UINT(0b0000100000000000, LCO(0b0010011111111111));
	TEST_ASSERT_EQUAL_UINT(0b0001000000000000, LCO(0b1010111111111111));
	TEST_ASSERT_EQUAL_UINT(0b0010000000000000, LCO(0b1001111111111111));
	TEST_ASSERT_EQUAL_UINT(0b0100000000000000, LCO(0b0011111111111111));
	TEST_ASSERT_EQUAL_UINT(0b1000000000000000, LCO(0b0111111111111111));

	TEST_ASSERT_EQUAL_UINT(0b10000000000000000, LCO(0b1111111111111111));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000001, LCO(0b0000000000000000));
}

void test_SLSB(void)
{
	TEST_ASSERT_EQUAL_UINT(0b0010011001010011, SLSB(0b0010011001010010));
	TEST_ASSERT_EQUAL_UINT(0b0010011001010011, SLSB(0b0010011001010001));
	TEST_ASSERT_EQUAL_UINT(0b0010011001010111, SLSB(0b0010011001010011));
	TEST_ASSERT_EQUAL_UINT(0b0010011001011111, SLSB(0b0010011001010111));
	TEST_ASSERT_EQUAL_UINT(0b0010011001111111, SLSB(0b0010011001011111));
	TEST_ASSERT_EQUAL_UINT(0b0010011011111111, SLSB(0b0010011001111111));
	TEST_ASSERT_EQUAL_UINT(0b0010011111111111, SLSB(0b0010011011111111));
	TEST_ASSERT_EQUAL_UINT(0b0010111111111111, SLSB(0b0010011111111111));
	TEST_ASSERT_EQUAL_UINT(0b0011111111111111, SLSB(0b0010111111111111));
	TEST_ASSERT_EQUAL_UINT(0b0111111111111111, SLSB(0b0011111111111111));
	TEST_ASSERT_EQUAL_UINT(0b1111111111111111, SLSB(0b0111111111111111));

	TEST_ASSERT_EQUAL_UINT(0b0000000000000001, SLSB(0b0000000000000000));
	TEST_ASSERT_EQUAL_UINT(0b11111111111111111, SLSB(0b1111111111111111));
}

void test_CLSB(void)
{
	TEST_ASSERT_EQUAL_UINT(0b0010011001010000, CLSB(0b0010011001010001));
	TEST_ASSERT_EQUAL_UINT(0b0010011001010000, CLSB(0b0010011001010010));
	TEST_ASSERT_EQUAL_UINT(0b0010011001010000, CLSB(0b0010011001010100));
	TEST_ASSERT_EQUAL_UINT(0b0010011001010000, CLSB(0b0010011001011000));
	TEST_ASSERT_EQUAL_UINT(0b0010011001000000, CLSB(0b0010011001010000));
	TEST_ASSERT_EQUAL_UINT(0b0010011001000000, CLSB(0b0010011001100000));
	TEST_ASSERT_EQUAL_UINT(0b0010010000000000, CLSB(0b0010011000000000));
	TEST_ASSERT_EQUAL_UINT(0b0010000000000000, CLSB(0b0010010000000000));
	TEST_ASSERT_EQUAL_UINT(0b0000000000000000, CLSB(0b0010000000000000));

	TEST_ASSERT_EQUAL_UINT(0b0000000000000001, SLSB(0b0000000000000000));
	TEST_ASSERT_EQUAL_UINT(0b11111111111111111, SLSB(0b1111111111111111));
}
